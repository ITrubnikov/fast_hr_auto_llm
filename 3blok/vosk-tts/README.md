# Vosk-TTS Docker ะะปะพะบ

**Text-to-Speech ัะตัะฒะธั ะฝะฐ ะพัะฝะพะฒะต Vosk-TTS ั ะฟะพะดะดะตัะถะบะพะน Triton Inference Server**

ะะปะพะบ ะฐะฝะฐะปะพะณะธัะฝัะน onnx-asr, ะฝะพ ะดะปั ัะธะฝัะตะทะฐ ัะตัะธ. ะะพะดะดะตัะถะธะฒะฐะตั 3 ััััะบะธั ะณะพะปะพัะฐ ัะตัะตะท Triton Server ะธ Docker.

## ๐ฏ ะัะพะฑะตะฝะฝะพััะธ

- ๐ณ **Docker-ready** - ะฟะพะปะฝะฐั ะบะพะฝัะตะนะฝะตัะธะทะฐัะธั
- โก **Triton Inference Server** - ะผะฐัััะฐะฑะธััะตะผัะน ML ัะตัะฒะธะฝะณ  
- ๐ค **3 ััััะบะธั ะณะพะปะพัะฐ** - ะัะธะฝะฐ, ะะปะตะฝะฐ, ะะฐะฒะตะป
- ๐ **ะะพะฝะธัะพัะธะฝะณ** - Prometheus ะผะตััะธะบะธ
- ๐ **Fallback** - ะฐะฒัะพะผะฐัะธัะตัะบะธะน ะฟะตัะตัะพะด ะฝะฐ ะปะพะบะฐะปัะฝัะน vosk-tts
- ๐ **REST API** - ะฟัะพััะฐั ะธะฝัะตะณัะฐัะธั

## ๐ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   FastAPI       โโโโโโ  TritonTTSClient โโโโโโ Triton Server   โ
โ   (Port 8200)   โ    โ                  โ    โ   (Port 8100)   โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
         โ                                               โ
         โ              โโโโโโโโโโโโโโโโโโโโ             โ
         โโโโโโโโโโโโโโโโ  VoskTTSEngine   โโโโโโโโโโโโโโโ
                        โ   (Fallback)     โ
                        โโโโโโโโโโโโโโโโโโโโ
```

## ๐ ะัััััะน ััะฐัั

### 1. ะะฐะฟััะบ ัะตัะตะท Docker Compose

```bash
# ะะปะพะฝะธััะนัะต ะธ ะฟะตัะตะนะดะธัะต ะฒ ะฟะฐะฟะบั
cd vosk-tts

# ะะฐะฟัััะธัะต ะฒัะต ัะตัะฒะธัั
docker-compose up -d

# ะัะพะฒะตัััะต ััะฐััั
curl http://localhost:8200/health
```

### 2. ะัะฟะพะปัะทะพะฒะฐะฝะธะต API

**ะกะธะฝัะตะท ัะตะบััะฐ:**
```bash
curl -X POST "http://localhost:8200/synthesize" \
     -H "Content-Type: application/json" \
     -d '{
       "text": "ะัะธะฒะตั! ะญัะพ ัะตัั ัะธะฝัะตะทะฐ ัะตัะธ.",
       "voice": "irina",
       "speed": 1.0
     }'
```

**ะกะฟะธัะพะบ ะณะพะปะพัะพะฒ:**
```bash
curl http://localhost:8200/voices
```

### 3. Swagger UI
ะัะบัะพะนัะต ะฒ ะฑัะฐัะทะตัะต: `http://localhost:8200/docs`

## ๐ญ ะะพัััะฟะฝัะต ะณะพะปะพัะฐ

| ะะพะปะพั | ะะพะป | ะะฟะธัะฐะฝะธะต | ะะพะดะตะปั |
|-------|-----|----------|--------|
| **irina** | ะะตะฝัะบะธะน | ะะตะนััะฐะปัะฝัะน, ัะตัะบะธะน | vosk-tts-irina |
| **elena** | ะะตะฝัะบะธะน | ะัะณะบะธะน, ะฟัะธััะฝัะน | vosk-tts-elena |
| **pavel** | ะัะถัะบะพะน | ะฃะฒะตัะตะฝะฝัะน, ัะฟะพะบะพะนะฝัะน | vosk-tts-pavel |

## ๐ง ะะพะฝัะธะณััะฐัะธั

### Docker Compose ะฟะพััั:
- **8100** - Triton HTTP
- **8101** - Triton GRPC
- **8102** - Triton Metrics  
- **8200** - TTS API
- **9091** - Prometheus

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั:
```bash
# Triton ัะตัะฒะตั
TRITON_URL=triton-tts:8000

# ะะพะณะธัะพะฒะฐะฝะธะต
LOG_LEVEL=INFO

# API ะฝะฐัััะพะนะบะธ
API_HOST=0.0.0.0
API_PORT=8080
```

## ๐ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
vosk-tts/
โโโ docker-compose.yml          # ะัะบะตัััะฐัะธั ัะตัะฒะธัะพะฒ
โโโ Dockerfile                  # API ะบะพะฝัะตะนะฝะตั
โโโ requirements.txt            # Python ะทะฐะฒะธัะธะผะพััะธ
โโโ src/vosk_tts/              # ะัะฝะพะฒะฝะพะน ะบะพะด
โ   โโโ __init__.py            # ะญะบัะฟะพััั ะผะพะดัะปั
โ   โโโ config.py              # ะะพะฝัะธะณััะฐัะธั
โ   โโโ tts.py                 # TTS ะดะฒะธะถะพะบ
โ   โโโ triton_client.py       # Triton ะบะปะธะตะฝั
โ   โโโ api.py                 # FastAPI ะธะฝัะตััะตะนั
โโโ triton_model_repository/   # ะะพะดะตะปะธ Triton
โ   โโโ vosk-tts-irina/       # ะะพะดะตะปั ะัะธะฝะฐ
โ   โโโ vosk-tts-elena/       # ะะพะดะตะปั ะะปะตะฝะฐ
โ   โโโ vosk-tts-pavel/       # ะะพะดะตะปั ะะฐะฒะตะป
โโโ monitoring/
    โโโ prometheus.yml         # ะะพะฝัะธะณััะฐัะธั ะผะพะฝะธัะพัะธะฝะณะฐ
```

## ๐ API Endpoints

### ะัะฝะพะฒะฝัะต

- `GET /` - ะะฝัะพัะผะฐัะธั ะพ ัะตัะฒะธัะต
- `GET /health` - ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
- `GET /voices` - ะกะฟะธัะพะบ ะณะพะปะพัะพะฒ
- `GET /stats` - ะกัะฐัะธััะธะบะฐ ัะตัะฒะธัะฐ

### TTS

- `POST /synthesize` - ะกะธะฝัะตะท ัะตะบััะฐ (JSON)
- `POST /synthesize/form` - ะกะธะฝัะตะท ัะตะบััะฐ (Form)
- `GET /audio/{file_id}` - ะกะบะฐัะฐัั ะฐัะดะธะพ ัะฐะนะป
- `DELETE /audio/{file_id}` - ะฃะดะฐะปะธัั ะฐัะดะธะพ ัะฐะนะป

### ะฃะฟัะฐะฒะปะตะฝะธะต

- `POST /cache/clear` - ะัะธััะธัั ะบะตั

## ๐ ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
pip install -r requirements.txt

# ะะฐะฟััะบ API (ะฑะตะท Triton)
python -m uvicorn src.vosk_tts.api:app --reload --port 8200

# ะะปะธ ัะพะปัะบะพ ั vosk-tts
python src/vosk_tts/api.py
```

### ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# ะัะพะฒะตัะบะฐ TTS
curl -X POST "http://localhost:8200/synthesize" \
     -H "Content-Type: application/json" \
     -d '{"text": "ะขะตัั", "voice": "irina"}'

# ะัะพะฒะตัะบะฐ ะทะดะพัะพะฒัั
curl http://localhost:8200/health
```

## ๐ง ะะฐัััะพะนะบะฐ Triton ะผะพะดะตะปะตะน

ะะฐะถะดะฐั ะผะพะดะตะปั ะธะผะตะตั ััััะบัััั:
```
vosk-tts-{voice}/
โโโ config.pbtxt      # ะะพะฝัะธะณััะฐัะธั Triton
โโโ 1/
    โโโ model.py      # Python backend
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะณะพะปะพัะฐ:

1. ะกะพะทะดะฐะนัะต ะฟะฐะฟะบั ะผะพะดะตะปะธ:
   ```bash
   mkdir -p triton_model_repository/vosk-tts-newvoice/1
   ```

2. ะกะบะพะฟะธััะนัะต config.pbtxt ะธ model.py
3. ะะทะผะตะฝะธัะต voice_path ะฒ model.py
4. ะะพะฑะฐะฒััะต ะณะพะปะพั ะฒ config.py

## ๐ ะะพะฝะธัะพัะธะฝะณ

### Prometheus ะผะตััะธะบะธ:
- Triton Server: `http://localhost:8102/metrics`
- Prometheus UI: `http://localhost:9091`

### Health checks:
```bash
# ะะฑัะตะต ะทะดะพัะพะฒัะต
curl http://localhost:8200/health

# Triton ััะฐััั  
curl http://localhost:8100/v2/health/ready
```

## ๐ Troubleshooting

### Triton ะฝะต ะทะฐะฟััะบะฐะตััั:
```bash
# ะัะพะฒะตัััะต ะปะพะณะธ
docker-compose logs triton-tts

# ะฃะฑะตะดะธัะตัั ััะพ vosk-tts ัััะฐะฝะพะฒะปะตะฝ
docker-compose exec triton-tts pip list | grep vosk
```

### ะะพะดะตะปั ะฝะต ะทะฐะณััะถะฐะตััั:
```bash
# ะัะพะฒะตัััะต ะผะพะดะตะปะธ ะฒ Triton
curl http://localhost:8100/v2/models

# ะะพะณะธ ะบะพะฝะบัะตัะฝะพะน ะผะพะดะตะปะธ
curl http://localhost:8100/v2/models/vosk-tts-irina
```

### API ะฝะตะดะพัััะฟะตะฝ:
```bash
# ะัะพะฒะตัััะต ะบะพะฝัะตะนะฝะตั
docker-compose ps

# ะะพะณะธ API
docker-compose logs vosk-tts-api
```

## ๐ฆ Production

### ะก GPU ะฟะพะดะดะตัะถะบะพะน:
1. ะะฐัะบะพะผะผะตะฝัะธััะนัะต GPU ะฝะฐัััะพะนะบะธ ะฒ docker-compose.yml
2. ะฃััะฐะฝะพะฒะธัะต nvidia-container-runtime
3. ะะทะผะตะฝะธัะต instance_group ะฒ config.pbtxt ะฝะฐ KIND_GPU

### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต:
```bash
# ะฃะฒะตะปะธัััะต ะบะพะปะธัะตััะฒะพ ัะตะฟะปะธะบ API
docker-compose up -d --scale vosk-tts-api=3

# ะะปะธ ัะฒะตะปะธัััะต instance_count ะฒ Triton ะบะพะฝัะธะณะฐั
```

### ะะตะทะพะฟะฐัะฝะพััั:
- ะะบะปััะธัะต API ะบะปััะธ ะฒ config.py
- ะะฐัััะพะนัะต CORS origins
- ะัะฟะพะปัะทัะนัะต HTTPS reverse proxy

## ๐ ะะฝัะตะณัะฐัะธั ั voice-dialog

ะญัะพั ะฑะปะพะบ ะธะฝัะตะณัะธััะตััั ั voice-dialog ัะธััะตะผะพะน:

```python
# ะ voice-dialog/src/voice_dialog/tts.py
class VoskTTSEngine:
    def __init__(self, config: TTSConfig):
        # ะัะฟะพะปัะทัะนัะต ััะพั Docker ัะตัะฒะธั
        self.triton_url = "localhost:8100"  # Triton
        self.api_url = "localhost:8200"     # API
```

## ๐ ะะธัะตะฝะทะธั

ะะฝะฐะปะพะณะธัะฝะพ ะพัะฝะพะฒะฝะพะผั ะฟัะพะตะบัั. Vosk-TTS ะธะผะตะตั Apache 2.0 ะปะธัะตะฝะทะธั.

---

**ะะตััะธั**: 0.1.0  
**ะกะพะฒะผะตััะธะผะพััั**: onnx-asr v0.1.0, voice-dialog v0.1.0
